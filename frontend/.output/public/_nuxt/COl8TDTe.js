import{E as H}from"./DjsjKbSU.js";import{S as V}from"./PdhWmqvX.js";import{e as N,r as y,x as S,h as T,L as F,c as n,o as l,a as e,H as h,I as _,M as K,N as g,t as r,_ as P,b as C,J as L,F as G,G as B,K as W,n as J,w as I,d as A}from"./CgBFakhS.js";import{u as O}from"./kJopPaI2.js";import{u as Q}from"./D6gG8p-B.js";import{getAuthorRanking as Y,checkFollowStatus as q,unfollowUser as X,followUser as Z}from"./C4XRcB4j.js";import{m as D}from"./CMFYFJiA.js";import"./awhFlHqN.js";const ee=""+new URL("spring.zm7bp0KK.mp4",import.meta.url).href,te=""+new URL("summer.DS9IczNY.mp4",import.meta.url).href,se=""+new URL("autumn.CkcCGpWB.mp4",import.meta.url).href,oe=""+new URL("winter.Cp5BLAQc.mp4",import.meta.url).href,le={class:"relative h-96 rounded-lg overflow-hidden mb-6 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"},ne={class:"absolute inset-0 z-0"},re={class:"relative w-full h-full"},ae={class:"absolute inset-0 w-full h-full overflow-hidden z-10"},ie=["src"],de={class:"relative h-full flex items-center justify-start pl-12 text-white z-30"},ce={class:"max-w-lg"},ue={class:"text-4xl md:text-6xl font-bold mb-4 animate-fade-in-up animate-delay-100"},me={class:"text-xl md:text-2xl animate-fade-in-up animate-delay-300"},pe={class:"absolute bottom-4 left-12 flex space-x-2 z-30"},ve=["onClick"],fe=N({__name:"Banner",props:{banners:{default:()=>[{id:1,src:ee,title:"春日暖阳",description:"春暖花开，万物复苏",type:"video"},{id:2,src:te,title:"夏日时光",description:"享受阳光与海滩",type:"video"},{id:3,src:se,title:"秋日私语",description:"感受秋日的温暖",type:"video"},{id:4,src:oe,title:"冬日恋歌",description:"雪花飞舞的季节",type:"video"}]}},setup($){const a=$,c=y(0),m=y([]),w=y([]);let b=null;const p=S(()=>a.banners[c.value]),j=()=>{const v=[];for(let i=0;i<20;i++)v.push({id:i,x:Math.random()*100,y:Math.random()*100,size:Math.random()*4+2,opacity:Math.floor(Math.random()*50)+10,duration:Math.random()*5+5,delay:Math.random()*2});m.value=v},k=()=>{w.value.length>0&&w.value.forEach(v=>{v&&v.play().catch(i=>{console.log("自动播放失败，需要用户交互:",i)})})},u=()=>{k(),document.removeEventListener("click",u),document.removeEventListener("touchstart",u),document.removeEventListener("mousemove",u)},E=v=>{c.value=v},U=()=>{c.value=(c.value-1+a.banners.length)%a.banners.length},z=()=>{c.value=(c.value+1)%a.banners.length},R=()=>{b=window.setInterval(()=>{z()},5e3)},M=()=>{b&&(clearInterval(b),b=null)};return T(()=>{R(),j(),k(),document.addEventListener("click",u),document.addEventListener("touchstart",u),document.addEventListener("mousemove",u)}),F(()=>{M(),document.removeEventListener("click",u),document.removeEventListener("touchstart",u),document.removeEventListener("mousemove",u)}),(v,i)=>(l(),n("section",le,[e("div",ne,[(l(!0),n(h,null,_(m.value,d=>(l(),n("div",{key:d.id,class:g(["absolute rounded-full bg-white/20",["animate-float",`opacity-${d.opacity}`]]),style:K({left:`${d.x}%`,top:`${d.y}%`,width:`${d.size}px`,height:`${d.size}px`,animationDuration:`${d.duration}s`,animationDelay:`${d.delay}s`})},null,6))),128))]),e("div",re,[e("div",ae,[(l(!0),n(h,null,_($.banners,(d,o)=>(l(),n("div",{key:d.id,class:g(["absolute inset-0",{"opacity-100":c.value===o,"opacity-0":c.value!==o}])},[e("video",{ref_for:!0,ref_key:"videoRefs",ref:w,src:d.src,class:"w-full h-full object-cover",autoplay:"",muted:"",loop:"",playsinline:"",preload:"auto",controlsList:"nodownload noplaybackrate"},null,8,ie)],2))),128))]),i[2]||(i[2]=e("div",{class:"absolute inset-0 bg-gradient-to-r from-primary/20 via-primary/10 to-transparent z-15"},null,-1)),i[3]||(i[3]=e("div",{class:"absolute inset-0 bg-grid-white/[0.02] bg-[length:40px_40px] z-20"},null,-1)),i[4]||(i[4]=e("div",{class:"absolute top-1/2 right-1/4 w-[300px] h-[300px] bg-blue-500/10 rounded-full blur-3xl -translate-x-1/2 -translate-y-1/2 animate-pulse z-15"},null,-1)),e("div",de,[e("div",ce,[e("h1",ue,r(p.value.title),1),e("p",me,r(p.value.description),1)])]),e("div",pe,[(l(!0),n(h,null,_($.banners,(d,o)=>(l(),n("button",{key:d.id,onClick:s=>E(o),class:g(["w-3 h-3 rounded-full transition-all duration-300",{"bg-white w-8":c.value===o,"bg-white/50":c.value!==o}])},null,10,ve))),128))]),e("button",{onClick:U,class:"absolute left-12 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 text-white w-10 h-10 rounded-full flex items-center justify-center z-30 transition-all"},[...i[0]||(i[0]=[e("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})],-1)])]),e("button",{onClick:z,class:"absolute right-12 top-1/2 transform -translate-y-1/2 bg-white/20 hover:bg-white/30 text-white w-10 h-10 rounded-full flex items-center justify-center z-30 transition-all"},[...i[1]||(i[1]=[e("svg",{class:"w-6 h-6",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})],-1)])])])]))}}),he=Object.assign(P(fe,[["__scopeId","data-v-ac8d6d2c"]]),{__name:"Banner"}),xe={class:"grid grid-cols-1 lg:grid-cols-[180px_1fr_300px] gap-8"},ge={class:"bg-card border border-border"},be={class:"p-4"},ye={class:"space-y-1"},_e={class:"flex items-center gap-2 flex-1"},we={key:0,class:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24"},ke=["onClick"],Ce={class:"flex items-center gap-2 flex-1"},Le={key:0,class:"w-4 h-4 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24"},$e={key:0,class:"absolute top-2 right-2 bg-primary text-white text-xs font-bold px-2 py-1 rounded-full"},ze={class:"p-4 md:p-6"},Me={class:"flex flex-col md:flex-row gap-4"},Be={key:0,class:"md:w-1/4 h-32 md:h-40 overflow-hidden rounded-md"},Ae=["src","alt"],Se={class:"flex-1"},je={class:"text-xl font-bold mb-2 hover:text-primary transition-colors"},Ee={class:"text-muted-foreground mb-4 line-clamp-2"},Ue={class:"flex items-center justify-between text-sm text-muted-foreground"},Re={class:"flex items-center space-x-4"},Ve={class:"flex items-center"},Ie={key:0,class:"w-6 h-6 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white text-xs font-bold"},De=["src"],Ne={class:"flex items-center gap-1"},Te={class:"flex items-center gap-1"},Fe={class:"flex items-center space-x-2"},Pe={key:0,class:"flex justify-center py-4"},He={class:"flex flex-col gap-3 w-full"},Ke={key:1,class:"text-center py-4 text-muted-foreground"},Ge={class:"space-y-6"},We={class:"bg-card rounded-lg border border-border p-4"},Je={class:"space-y-3"},Oe={class:"text-lg font-bold text-muted-foreground"},Qe={class:"flex-1"},Ye={class:"text-sm font-medium hover:text-primary transition-colors line-clamp-2"},qe={class:"text-xs text-muted-foreground mt-1 flex items-center gap-1"},Xe={class:"bg-card rounded-lg border border-border p-4"},Ze={class:"space-y-3"},et={class:"w-8 h-8 rounded-full bg-muted flex items-center justify-center text-sm font-bold"},tt={class:"flex-1"},st={class:"flex items-center justify-between"},ot={class:"text-sm font-medium"},lt=["onClick"],nt={class:"text-xs text-muted-foreground"},rt=N({__name:"index",setup($){const a=O(),c=Q(),m=y(null),w=y(null),b=y([]),p=y({}),j=S(()=>[...a.articles].sort((o,s)=>(s.likes||0)-(o.likes||0)).slice(0,3)),k=S(()=>[...a.articles].sort((o,s)=>{const f=(o.views||0)+(o.likes||0),x=(s.views||0)+(s.likes||0)-f;return x!==0?x:new Date(s.createdAt).getTime()-new Date(o.createdAt).getTime()})),u=y(0),E=S(()=>a.categories),U=()=>{if(!w.value||a.isLoadingMore||!a.hasMore)return;const{scrollTop:o,scrollHeight:s,clientHeight:f}=w.value;s-o-f<100&&a.loadMoreArticles()},z=async()=>{try{const o=await Y();if(b.value=o,c.isLoggedIn)for(const s of o)try{const f=await q(s.id);p.value[s.id]=f.isFollowing}catch(f){console.error(`检查关注状态失败（作者ID: ${s.id}）:`,f),p.value[s.id]=!1}}catch(o){console.error("获取作者榜失败:",o),b.value=[]}},R=async o=>{try{if(!c.isLoggedIn){window.location.href="/login";return}p.value[o]?(await X(o),p.value[o]=!1):(await Z(o),p.value[o]=!0)}catch(s){console.error("操作失败:",s),s.response?.data?.message==="不能关注自己"?D.error("不能关注自己"):D.error("操作失败，请稍后重试")}};T(async()=>{try{await a.fetchCategories();const o=await a.fetchArticles({page:1,size:10});u.value=o?.total||0,await z()}catch(o){console.error("获取数据失败:",o)}}),F(()=>{});const M=async o=>{m.value=o,await v()},v=async()=>{try{const o=await a.fetchArticles({page:1,size:10,categoryId:m.value||void 0,append:!1});m.value===null&&(u.value=o?.total||0)}catch(o){console.error("获取文章失败:",o)}},i=()=>{console.log("刷新文章榜")},d=o=>({1:"bg-blue-100 text-blue-700",2:"bg-green-100 text-green-700",3:"bg-purple-100 text-purple-700",4:"bg-pink-100 text-pink-700",5:"bg-yellow-100 text-yellow-700",6:"bg-orange-100 text-orange-700",7:"bg-teal-100 text-teal-700",8:"bg-red-100 text-red-700"})[o]||"bg-primary/10 text-primary";return(o,s)=>{const f=J("router-link");return l(),n(h,null,[C(he),e("div",xe,[e("aside",ge,[e("div",be,[s[4]||(s[4]=e("h3",{class:"font-bold text-lg mb-4"},"文章分类",-1)),e("ul",ye,[e("li",{onClick:s[0]||(s[0]=t=>M(null)),class:g(["block px-4 py-2 cursor-pointer transition-colors flex items-center gap-3 relative",m.value===null?"bg-blue-50 text-blue-600 font-medium rounded-lg":"text-[#515767] hover:bg-blue-50 hover:text-blue-600 rounded-lg"])},[e("div",_e,[m.value===null?(l(),n("svg",we,[...s[1]||(s[1]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):L("",!0),s[2]||(s[2]=e("span",null,"全部文章",-1))]),e("span",{class:g(["text-xs",m.value===null?"text-blue-500":"text-muted-foreground"])},r(u.value),3)],2),(l(!0),n(h,null,_(E.value,t=>(l(),n("li",{key:t.id,onClick:x=>M(t.id),class:g(["block px-4 py-2 cursor-pointer transition-colors flex items-center gap-3 relative",m.value===t.id?"bg-blue-50 text-blue-600 font-medium rounded-lg":"text-[#515767] hover:bg-blue-50 hover:text-blue-600 rounded-lg"])},[e("div",Ce,[m.value===t.id?(l(),n("svg",Le,[...s[3]||(s[3]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):L("",!0),e("span",null,r(t.name),1)]),e("span",{class:g(["text-xs",m.value===t.id?"text-blue-500":"text-muted-foreground"])},r(t.articleCount),3)],10,ke))),128))])])]),e("main",null,[e("div",{class:"space-y-6 max-h-[calc(100vh-250px)] overflow-y-auto p-1",ref_key:"articleListContainer",ref:w,onScroll:U},[!B(a).articleLoading&&k.value.length===0?(l(),G(H,{key:0,title:"暂无文章",description:"目前没有发布任何文章，敬请期待"})):B(a).articleLoading&&k.value.length===0?(l(),n(h,{key:1},_(5,t=>e("div",{key:`skeleton-${t}`,class:"space-y-6"},[C(V,{type:"article-card"})])),64)):(l(),n(h,{key:2},[(l(!0),n(h,null,_(k.value,(t,x)=>(l(),n("div",{key:t.id,class:"bg-card rounded-lg border border-border overflow-hidden hover:shadow-md transition-shadow relative"},[x<3?(l(),n("div",$e," 置顶 ")):L("",!0),e("div",ze,[e("div",Me,[t.cover?(l(),n("div",Be,[e("img",{src:t.cover,alt:t.title,class:"w-full h-full object-cover"},null,8,Ae)])):L("",!0),e("div",Se,[e("h3",je,[C(f,{to:`/article/${t.id}`,class:"hover:text-primary transition-colors"},{default:I(()=>[A(r(t.title||`文章 ${t.id}`),1)]),_:2},1032,["to"])]),e("p",Ee,r(t.summary||t.content.replace(/<[^>]+>/g,"").substring(0,50)+(t.content.replace(/<[^>]+>/g,"").length>50?"...":"")),1),e("div",Ue,[e("div",Re,[e("div",Ve,[t.author?.avatar?(l(),n("img",{key:1,src:t.author?.avatar,alt:"作者头像",class:"w-6 h-6 rounded-full mr-2"},null,8,De)):(l(),n("div",Ie,r((t.author?.nickname||t.author?.username||"U").charAt(0).toUpperCase()),1)),e("span",null,r(t.author?.nickname||t.author?.username||"匿名"),1)]),e("span",Ne,[s[5]||(s[5]=e("svg",{class:"w-4 h-4 text-muted-foreground",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)),A(" "+r(t.views)+" 阅读 ",1)]),e("span",Te,[s[6]||(s[6]=e("svg",{class:"w-4 h-4 text-muted-foreground",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),A(" "+r(t.likes||0)+" 点赞 ",1)])]),e("div",Fe,[t.category?(l(),n("span",{key:0,class:g(["px-2 py-0.5 rounded text-xs",d(t.category.id)])},r(t.category.name),3)):L("",!0)])])])])])]))),128)),B(a).isLoadingMore?(l(),n("div",Pe,[e("div",He,[C(V,{type:"article-card"}),C(V,{type:"article-card"})])])):!B(a).hasMore&&k.value.length>0?(l(),n("div",Ke," 没有更多文章了 ")):L("",!0)],64))],544)]),e("aside",Ge,[s[10]||(s[10]=W('<div class="bg-card rounded-lg border border-border p-4" data-v-be193cf5><div class="flex items-center justify-between mb-4" data-v-be193cf5><h3 class="font-bold text-lg" data-v-be193cf5>下午好！</h3><button class="px-3 py-1 bg-primary text-white rounded text-sm hover:bg-primary/90 transition-colors" data-v-be193cf5> 去签到 </button></div><p class="text-sm text-muted-foreground" data-v-be193cf5>点亮社区的每一天</p></div>',1)),e("div",We,[e("div",{class:"flex items-center justify-between mb-4"},[s[7]||(s[7]=e("h3",{class:"font-bold text-lg"},"热门文章",-1)),e("button",{class:"text-sm text-primary hover:underline",onClick:i}," 换一换 ")]),e("ul",Je,[(l(!0),n(h,null,_(j.value,(t,x)=>(l(),n("li",{key:t.id,class:"flex items-start gap-3"},[e("span",Oe,r(x+1),1),e("div",Qe,[e("h4",Ye,[C(f,{to:`/article/${t.id}`,class:"hover:text-primary transition-colors"},{default:I(()=>[A(r(t.title||`文章 ${t.id}`),1)]),_:2},1032,["to"])]),e("div",qe,[s[8]||(s[8]=e("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),e("span",null,r(t.likes||0),1)])])]))),128))])]),e("div",Xe,[s[9]||(s[9]=e("h3",{class:"font-bold text-lg mb-4"},"作者榜",-1)),e("ul",Ze,[(l(!0),n(h,null,_(b.value,(t,x)=>(l(),n("li",{key:t.id,class:"flex items-center gap-3"},[e("div",et,r(x+1),1),e("div",tt,[e("div",st,[e("span",ot,r(t.nickname||t.username),1),e("button",{class:g(["text-xs hover:underline",(p.value[t.id],"text-primary")]),onClick:at=>R(t.id)},r(p.value[t.id]?"已关注":"+ 关注"),11,lt)]),e("p",nt," 发布了 "+r(t.articleCount)+" 篇文章 ",1)])]))),128))])])])])],64)}}}),ht=P(rt,[["__scopeId","data-v-be193cf5"]]);export{ht as default};
