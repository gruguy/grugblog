const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./C4XRcB4j.js","./D6gG8p-B.js","./CgBFakhS.js","./entry.Cfh3Lcf5.css","./BbXNEZ8E.js"])))=>i.map(i=>d[i]);
import{e as K,r as h,x as V,c as n,a as t,J as A,t as l,H as F,I as L,M as G,o as r,N,_ as Z,T as tt,h as et,G as $,P as R,Q as J,b as P,U as Q,n as ot,w as X,d as q}from"./CgBFakhS.js";import{u as st}from"./D6gG8p-B.js";import{getActivityData as at}from"./C4XRcB4j.js";import{a as nt}from"./CMFYFJiA.js";import"./awhFlHqN.js";const rt={class:"github-style-calendar"},lt={class:"calendar-header"},it={class:"title"},dt={class:"calendar-main"},ct={class:"year-nav"},ut=["onClick"],mt={class:"calendar-container"},vt={class:"calendar-table"},ft={class:"month-row"},pt=["colspan"],gt={class:"weekday-cell"},ht=["title","onClick","onMouseenter"],yt={class:"calendar-legend"},_t={class:"legend-colors"},bt=K({__name:"GitHubStyleCalendar",props:{data:{},title:{},showLegend:{type:Boolean}},emits:["click","yearChange"],setup(w,{emit:c}){const S=w,y=c,x=h(new Date().getFullYear()),k=h(!1),f=h(""),v=h({top:"0px",left:"0px"}),M=V(()=>{const a=new Date().getFullYear();return[a-4,a-3,a-2,a-1,a]}),E=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],j=["#d0d7de","#9be9a8","#40c463","#30a14e","#216e39"],p=V(()=>new Map(S.data.filter(a=>a.date.startsWith(`${x.value}-`)).map(a=>[a.date,a]))),g=V(()=>{const a=[],o=O.value,e=Math.ceil(o.length/7),m=Array.from({length:e},()=>new Map);o.forEach((u,U)=>{if(u.isCurrentYear){const Y=Math.floor(U/7),C=m[Y].get(u.month)||0;m[Y].set(u.month,C+1)}});const d=new Array(e).fill(-1);m.forEach((u,U)=>{let Y=0,C=-1;if(u.size>0)for(let W=0;W<12;W++){const H=u.get(W)||0;(H>Y||H===Y&&C===-1)&&(Y=H,C=W)}d[U]=C});const s=new Array(12).fill(0);d.forEach(u=>{u!==-1&&s[u]++});for(let u=0;u<12;u++){const U=new Date(0,u).toLocaleDateString("en-US",{month:"short"});a.push({month:U,days:s[u]})}return a}),T=a=>{const o=a.getFullYear(),e=String(a.getMonth()+1).padStart(2,"0"),m=String(a.getDate()).padStart(2,"0");return`${o}-${e}-${m}`},B=(a,o)=>{const e=a?.count||0;return`${o.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})}：${e}次贡献`},O=V(()=>{const a=[],o=new Date(x.value,11,31),e=new Date(x.value,0,1),m=new Date(e);m.setDate(e.getDate()-e.getDay()+(e.getDay()===0?-6:1));let d=new Date(m);const s=new Date(o);for(s.setDate(s.getDate()+(6-s.getDay()));d<=s;){const u=T(d),U=p.value.get(u),Y=d.getMonth();let C=d.getDay();C=C===0?6:C-1,a.push({date:u,count:U?.count||0,tooltip:B(U,d),isCurrentYear:d.getFullYear()===x.value,month:Y,dayOfWeek:C,actualDate:new Date(d)}),d.setDate(d.getDate()+1)}return a}),I=V(()=>{const a=O.value,o=Array.from({length:7},()=>[]);return a.forEach(e=>{o[e.dayOfWeek].push(e)}),o});console.log(I.value);const i=a=>{const o=a.count;let e=0;return o>0&&(e=1),o>3&&(e=2),o>6&&(e=3),o>9&&(e=4),`level-${e}${a.isCurrentYear?"":" other-year"}`},D=a=>{x.value=a,y("yearChange",a)},b=(a,o)=>{f.value=a.tooltip,k.value=!0,v.value={top:`${o.pageY-40}px`,left:`${o.pageX+10}px`}},_=()=>{k.value=!1},z=a=>{const o=p.value.get(a.date);y("click",a.date,o||void 0)};return(a,o)=>(r(),n("div",rt,[t("div",lt,[t("h3",it,l(w.title||"Activity Calendar"),1)]),t("div",dt,[t("div",ct,[(r(!0),n(F,null,L(M.value,e=>(r(),n("div",{key:e,class:N(["year-item",{active:e===x.value}]),onClick:m=>D(e)},l(e),11,ut))),128))]),t("div",mt,[t("table",vt,[t("thead",null,[t("tr",ft,[o[0]||(o[0]=t("th",{class:"weekday-header"},null,-1)),(r(!0),n(F,null,L(g.value,(e,m)=>(r(),n("th",{key:m,class:"month-header",colspan:e.days},l(e.month),9,pt))),128))])]),t("tbody",null,[(r(!0),n(F,null,L(I.value,(e,m)=>(r(),n("tr",{key:m},[t("td",gt,l(E[m]),1),(r(!0),n(F,null,L(e,(d,s)=>(r(),n("td",{key:s,class:N(["calendar-day-cell",i(d)]),title:d.tooltip,onClick:u=>z(d),onMouseenter:u=>b(d,u),onMouseleave:_},null,42,ht))),128))]))),128))])]),t("div",yt,[o[1]||(o[1]=t("div",{class:"legend-text"},"Less",-1)),t("div",_t,[(r(),n(F,null,L(j,e=>t("div",{class:"legend-color",key:e,style:G({backgroundColor:e})},null,4)),64))]),o[2]||(o[2]=t("div",{class:"legend-text"},"More",-1))])])]),k.value?(r(),n("div",{key:0,class:"calendar-tooltip",style:G(v.value)},l(f.value),5)):A("",!0)]))}}),xt=Object.assign(Z(bt,[["__scopeId","data-v-f4d4b6c7"]]),{__name:"GitHubStyleCalendar"}),wt=tt("activity",()=>{const w=h([]),c=h(!1),S=h(null),y=async f=>{c.value=!0,S.value=null;try{let v=[];try{const i=await at(f);typeof i=="object"&&i!==null&&"data"in i?v=Array.isArray(i.data)?i.data:[]:v=Array.isArray(i)?i:[]}catch{console.log("获取真实活动数据失败，使用模拟数据");const D=f||new Date().getFullYear();for(let b=0;b<12;b++)for(let _=1;_<=28;_++)v.push({date:`${D}-${(b+1).toString().padStart(2,"0")}-${_.toString().padStart(2,"0")}`,count:Math.floor(Math.random()*10),description:"模拟活动数据"})}const E=f||new Date().getFullYear(),j=[],p=new Map;v.forEach(i=>{i.date.startsWith(`${E}-`)&&p.set(i.date,i.count)});const g=new Date(E,0,1),T=new Date(E,11,31),B=Math.abs(T.getTime()-g.getTime()),O=Math.ceil(B/(1e3*60*60*24)),I=i=>{const D=i.getFullYear(),b=String(i.getMonth()+1).padStart(2,"0"),_=String(i.getDate()).padStart(2,"0");return`${D}-${b}-${_}`};for(let i=0;i<=O;i++){const D=new Date(g);D.setDate(g.getDate()+i);const b=I(D),_=p.get(b)||0;j.push({date:b,count:_,description:_>0?`${_} 条内容`:"无内容"})}return w.value=j,w.value}catch(v){return S.value=v.message||"获取活动数据失败",console.error("获取活动数据失败:",v),w.value}finally{c.value=!1}},x=f=>w.value.find(v=>v.date===f),k=V(()=>w.value.reduce((f,v)=>f+v.count,0));return{activityData:w,isLoading:c,error:S,fetchActivityData:y,getActivityByDate:x,totalActivityCount:k}}),kt={class:"max-w-6xl mx-auto mt-12"},Dt={class:"bg-card border border-border rounded-lg shadow-md p-8"},Ct={class:"flex flex-col md:flex-row gap-8 mb-12"},$t={class:"md:w-1/3"},At={class:"flex flex-col items-center"},St={class:"relative mb-4"},Mt={key:0,class:"w-32 h-32 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-bold text-2xl border-4 border-primary"},Ut=["src"],Yt=["disabled"],Ft={class:"text-2xl font-bold mb-2"},Lt={class:"text-muted-foreground mb-4"},Et={class:"flex space-x-4 mb-4"},Tt={class:"text-center"},It={class:"text-xl font-bold"},jt={class:"text-center"},Ot={class:"text-xl font-bold"},Vt={class:"md:w-2/3"},Bt={class:"flex justify-between items-center mb-4"},Nt={class:"flex space-x-2"},Wt={class:"space-y-4"},zt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ht={class:"text-foreground"},Pt={class:"text-foreground"},Gt={key:1,class:"text-foreground"},Rt={key:1,class:"text-foreground"},Jt={class:"mt-12 mb-12"},Qt={class:"border-t border-border"},Xt={class:"flex space-x-8 mb-8"},qt={key:0,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Kt={class:"text-lg font-bold mb-2 text-foreground hover:text-primary transition-colors"},Zt={class:"text-muted-foreground text-sm mb-3 line-clamp-2"},te={class:"flex items-center justify-between text-xs text-muted-foreground"},ee={key:0,class:"col-span-1 md:col-span-2 text-center py-12 text-muted-foreground"},oe={key:1,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},se={class:"text-lg font-bold mb-2 text-foreground hover:text-primary transition-colors"},ae={class:"text-muted-foreground text-sm mb-3 line-clamp-2"},ne={class:"flex items-center justify-between text-xs text-muted-foreground"},re={key:0,class:"col-span-1 md:col-span-2 text-center py-12 text-muted-foreground"},le={key:2,class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={class:"flex items-center gap-4"},de={class:"relative"},ce={key:0,class:"w-16 h-16 rounded-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center text-white font-bold text-lg border-2 border-primary"},ue=["src"],me={class:"flex-1"},ve={class:"text-lg font-bold text-foreground hover:text-primary transition-colors"},fe={class:"text-muted-foreground text-sm mb-2"},pe={class:"text-muted-foreground text-xs line-clamp-2"},ge={class:"flex items-center gap-4 mt-2 text-xs text-muted-foreground"},he=["onClick"],ye={key:0,class:"col-span-1 md:col-span-2 text-center py-12 text-muted-foreground"},De=K({__name:"Profile",setup(w){const c=st(),S=wt(),y=h("liked"),x=h(null),k=h([]),f=h([]),v=h([]),M=h(!1),E=(o,e)=>{console.log("点击了日期:",o,e)},j=async o=>{console.log("切换到年份:",o),await S.fetchActivityData(o)},p=h(!1),g=h({nickname:"",bio:""}),T=async()=>{try{await c.fetchUserInfo(),c.user&&(g.value.nickname=c.user.nickname||"",g.value.bio=c.user.bio||"")}catch(o){console.error("获取用户信息失败:",o)}},B=async()=>{try{M.value=!0;const o=await getUserLikedArticles();k.value=o}catch(o){console.error("获取点赞文章失败:",o)}finally{M.value=!1}},O=async()=>{try{M.value=!0;const o=await getUserCollectedArticles();f.value=o}catch(o){console.error("获取收藏文章失败:",o)}finally{M.value=!1}},I=async()=>{try{M.value=!0;const o=await getFollowedAuthors();v.value=o}catch(o){console.error("获取关注的作者失败:",o)}finally{M.value=!1}},i=()=>{p.value=!0,c.user&&(g.value.nickname=c.user.nickname||"",g.value.bio=c.user.bio||"")},D=()=>{p.value=!1},b=async()=>{try{await updateUserInfo(g.value),await T(),p.value=!1}catch(o){console.error("更新用户信息失败:",o)}},_=async o=>{try{await Q(async()=>{const{unfollowUser:e}=await import("./C4XRcB4j.js");return{unfollowUser:e}},__vite__mapDeps([0,1,2,3]),import.meta.url).then(({unfollowUser:e})=>e(o)),await I()}catch(e){console.error("取消关注失败:",e)}},z=()=>{x.value?.click()},a=async o=>{const e=o.target;if(e.files&&e.files.length>0){const m=e.files[0];try{const{uploadFile:d}=await Q(async()=>{const{uploadFile:u}=await import("./BbXNEZ8E.js");return{uploadFile:u}},__vite__mapDeps([4,1,2,3]),import.meta.url),s=await d(m);await updateUserInfo({avatar:s.url}),await T(),e.value=""}catch(d){console.error("头像上传失败:",d),nt("头像上传失败，请重试")}}};return et(async()=>{if(!c.isLoggedIn){window.location.href="/login";return}await T(),await B(),await O(),await I(),await S.fetchActivityData()}),(o,e)=>{const m=xt,d=ot("router-link");return r(),n("div",kt,[t("div",Dt,[t("div",Ct,[t("div",$t,[t("div",At,[t("div",St,[$(c).user?.avatar?(r(),n("img",{key:1,src:$(c).user?.avatar,alt:"头像",class:"w-32 h-32 rounded-full object-cover border-4 border-primary"},null,8,Ut)):(r(),n("div",Mt,l($(c).user?.username.charAt(0).toUpperCase()||"U"),1)),t("button",{class:"absolute bottom-0 right-0 bg-primary text-white p-2 rounded-full border-2 border-card hover:bg-primary/90 transition-colors",onClick:z,disabled:p.value},[...e[5]||(e[5]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])],8,Yt),t("input",{ref_key:"fileInput",ref:x,type:"file",accept:"image/*",class:"hidden",onChange:a},null,544)]),t("h2",Ft,l($(c).user?.username||"用户"),1),t("p",Lt,l($(c).user?.email||"未设置邮箱"),1),t("div",Et,[t("div",Tt,[t("div",It,l(k.value.length),1),e[6]||(e[6]=t("div",{class:"text-sm text-muted-foreground"},"点赞",-1))]),t("div",jt,[t("div",Ot,l(f.value.length),1),e[7]||(e[7]=t("div",{class:"text-sm text-muted-foreground"},"收藏",-1))])])])]),t("div",Vt,[t("div",Bt,[e[8]||(e[8]=t("h3",{class:"text-xl font-bold"},"个人信息",-1)),t("div",Nt,[p.value?A("",!0):(r(),n("button",{key:0,onClick:i,class:"bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-colors"}," 编辑 ")),p.value?(r(),n("button",{key:1,onClick:D,class:"bg-muted text-foreground px-4 py-2 rounded-md hover:bg-muted/80 transition-colors"}," 取消 ")):A("",!0),p.value?(r(),n("button",{key:2,onClick:b,class:"bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-colors"}," 保存 ")):A("",!0)])]),t("div",Wt,[t("div",zt,[t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium mb-1"},"用户名",-1)),t("p",Ht,l($(c).user?.username||"未设置"),1)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium mb-1"},"邮箱",-1)),t("p",Pt,l($(c).user?.email||"未设置"),1)])]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium mb-1"},"昵称",-1)),p.value?R((r(),n("input",{key:0,"onUpdate:modelValue":e[0]||(e[0]=s=>g.value.nickname=s),type:"text",class:"w-full p-2 border border-border rounded-md",placeholder:"请输入昵称"},null,512)),[[J,g.value.nickname]]):(r(),n("p",Gt,l($(c).user?.nickname||"未设置"),1))]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium mb-1"},"个人简介",-1)),p.value?R((r(),n("textarea",{key:0,"onUpdate:modelValue":e[1]||(e[1]=s=>g.value.bio=s),class:"w-full p-2 border border-border rounded-md resize-none h-24",placeholder:"请输入个人简介"},null,512)),[[J,g.value.bio]]):(r(),n("p",Rt,l($(c).user?.bio||"未设置"),1))])])])]),t("div",Jt,[e[13]||(e[13]=t("h3",{class:"text-xl font-bold mb-6"},"我的活动日历",-1)),P(m,{data:$(S).activityData,title:"我的活动日历","show-legend":!0,onClick:E,onYearChange:j},null,8,["data"])]),t("div",Qt,[t("div",Xt,[t("button",{onClick:e[2]||(e[2]=s=>y.value="liked"),class:N(["py-4 text-sm font-medium transition-colors",y.value==="liked"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"])}," 点赞内容 ",2),t("button",{onClick:e[3]||(e[3]=s=>y.value="collected"),class:N(["py-4 text-sm font-medium transition-colors",y.value==="collected"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"])}," 收藏内容 ",2),t("button",{onClick:e[4]||(e[4]=s=>y.value="following"),class:N(["py-4 text-sm font-medium transition-colors",y.value==="following"?"text-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground"])}," 关注的作者 ",2)]),y.value==="liked"?(r(),n("div",qt,[(r(!0),n(F,null,L(k.value,s=>(r(),n("div",{key:s.id,class:"bg-muted rounded-lg p-4 hover:shadow-md transition-shadow"},[t("h3",Kt,[P(d,{to:`/article/${s.id}`},{default:X(()=>[q(l(s.title),1)]),_:2},1032,["to"])]),t("p",Zt,l(s.summary),1),t("div",te,[t("span",null,l(new Date(s.createdAt).toLocaleDateString()),1),t("span",null,l(s.views)+" 阅读 · "+l(s.likes)+" 点赞",1)])]))),128)),k.value.length===0?(r(),n("div",ee," 还没有点赞内容 ")):A("",!0)])):A("",!0),y.value==="collected"?(r(),n("div",oe,[(r(!0),n(F,null,L(f.value,s=>(r(),n("div",{key:s.id,class:"bg-muted rounded-lg p-4 hover:shadow-md transition-shadow"},[t("h3",se,[P(d,{to:`/article/${s.id}`},{default:X(()=>[q(l(s.title),1)]),_:2},1032,["to"])]),t("p",ae,l(s.summary),1),t("div",ne,[t("span",null,l(new Date(s.createdAt).toLocaleDateString()),1),t("span",null,l(s.views)+" 阅读 · "+l(s.likes)+" 点赞",1)])]))),128)),f.value.length===0?(r(),n("div",re," 还没有收藏内容 ")):A("",!0)])):A("",!0),y.value==="following"?(r(),n("div",le,[(r(!0),n(F,null,L(v.value,s=>(r(),n("div",{key:s.id,class:"bg-muted rounded-lg p-4 hover:shadow-md transition-shadow"},[t("div",ie,[t("div",de,[s.avatar?(r(),n("img",{key:1,src:s.avatar,alt:"头像",class:"w-16 h-16 rounded-full object-cover border-2 border-primary"},null,8,ue)):(r(),n("div",ce,l(s.username.charAt(0).toUpperCase()||"U"),1))]),t("div",me,[t("h3",ve,l(s.username),1),t("p",fe,l(s.nickname||"未设置昵称"),1),t("p",pe,l(s.bio||"未设置简介"),1),t("div",ge,[t("span",null,l(s.articleCount||0)+" 篇文章",1),t("span",null,l(s.followerCount||0)+" 位粉丝",1)])]),t("button",{class:"bg-primary text-white px-4 py-2 rounded-md hover:bg-primary/90 transition-colors text-sm",onClick:u=>_(s.id)}," 已关注 ",8,he)])]))),128)),v.value.length===0?(r(),n("div",ye," 还没有关注的作者 ")):A("",!0)])):A("",!0)])])])}}});export{De as default};
