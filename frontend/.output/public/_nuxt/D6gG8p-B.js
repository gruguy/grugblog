import{T as d,r as a,a1 as h}from"./CgBFakhS.js";const m=e=>n.post("/auth/login",e),w=e=>n.post("/auth/register",e),p=()=>n.get("/auth/user"),f=()=>n.post("/auth/logout"),u=d("user",()=>{const e=a(localStorage.getItem("token")),r=a(null),t=a(!!e.value),c=async(o,g)=>{try{const s=await m({username:o,password:g});return e.value=s.token,r.value=s.user,t.value=!0,localStorage.setItem("token",s.token),s}catch(s){throw s}},i=async()=>{if(e.value)try{const o=await p();return r.value=o,o}catch(o){throw l(),o}},l=async()=>{try{e.value&&await f()}catch(o){console.error("登出失败:",o)}finally{e.value=null,r.value=null,t.value=!1,localStorage.removeItem("token")}};return{token:e,user:r,isLoggedIn:t,userLogin:c,fetchUserInfo:i,userLogout:l}}),n=h.create({baseURL:"/api",timeout:1e4,headers:{"Content-Type":"application/json;charset=UTF-8"}});n.interceptors.request.use(e=>{if(console.log("请求URL:",e.url),console.log("请求数据:",e.data),console.log("请求头:",e.headers),e.url?.includes("/auth/login")||e.url?.includes("/auth/register"))return e;const t=u().token||localStorage.getItem("token");return t&&e.headers&&(e.headers.Authorization=`Bearer ${t}`),e},e=>(console.error("请求错误:",e),Promise.reject(e)));n.interceptors.response.use(e=>{console.log("响应URL:",e.config.url),console.log("响应状态码:",e.status),console.log("响应数据:",e.data);const r=e.data;return r.code!==void 0?r.code!==200?(r.code===401&&(u().userLogout(),window.location.href="/admin/login"),Promise.reject(new Error(r.message||"请求失败"))):r.data:r},e=>{if(console.error("响应错误:",e),console.error("错误响应数据:",e.response?.data),console.error("错误状态码:",e.response?.status),console.error("错误配置:",e.config),e.response){const{status:r,data:t}=e.response;switch(r){case 401:u().userLogout();break;case 403:return Promise.reject(new Error("没有权限"));case 404:return Promise.reject(new Error("请求的资源不存在"));case 500:return Promise.reject(new Error("服务器内部错误"));default:return Promise.reject(new Error(t?.message||"请求失败"))}}return Promise.reject(e)});export{w as r,n as s,u};
